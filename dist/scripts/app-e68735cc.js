"use strict";angular.module("studyBuddy",["ngAnimate","restangular","ui.router","ui.bootstrap","firebase","sticky"]).config(["$stateProvider","$urlRouterProvider",function(a,e){a.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainController",controllerAs:"main"}).state("dashboard",{url:"/dashboard",templateUrl:"app/dashboard/dashboard.html",controller:"DashboardController",controllerAs:"dash"}).state("group",{url:"/create_group",templateUrl:"app/group/group.html",controller:"GroupCtrl",controllerAs:"groups"}).state("list",{url:"/list",templateUrl:"app/list/list.html",controller:"ListController",controllerAs:"list"}).state("manage",{url:"/manage",templateUrl:"app/manage/manage.html",controller:"ManageController",controllerAs:"manage"}),e.otherwise("/")}]).factory("Auth",["$firebaseObject","$state",function(a,e){function o(e){if(null===e)return null;var o=t.child(e.facebook.id),l=e.facebook.cachedUserProfile;return o.update({uid:e.facebook.id,fb:e.facebook,name:l.first_name,photo:l.picture.data.url}),o=a(t.child(e.facebook.id))}var t=new Firebase("https://study-buddy.firebaseio.com/users");return{onAuth:function(a){t.onAuth(function(e){a(o(e))})},fbLogin:function(){return t.authWithOAuthPopup("facebook",function(a,o){console.log(o),a?console.log("Login Failed!",a):(e.go("dashboard"),console.log("Authenticated successfully"))},{remember:"sessionOnly"})},logout:function(){t.unauth(),e.go("home"),console.log("goodbye")},loggedIn:function(){return t.getAuth()?!0:void e.go("home")}}}]),angular.module("studyBuddy").controller("ManageController",["$firebaseObject","$firebaseArray","Auth",function(a,e,o){var t=this;o.onAuth(function(a){t.user=a}),o.loggedIn();var l=new Firebase("https://study-buddy.firebaseio.com/groups/"+t.user.$id);this.obj=a(l),this.arr=e(l),this.update={},this.edit=function(a){return l.update(a),this.update={}},this.delete=function(a){l.remove(a)}}]),angular.module("studyBuddy").controller("MainController",["$firebaseArray","$firebaseObject","Auth",function(a,e,o){var t=this,l=new Firebase("https://study-buddy.firebaseio.com/users");this.obj=a(l),this.userArray={},this.fbLogin=o.fbLogin,o.onAuth(function(a){t.user=a,null===a&&console.log("null")})}]),angular.module("studyBuddy").controller("ListController",["$firebaseObject","$firebaseArray","Auth",function(a,e,o){o.loggedIn();var t=this;o.onAuth(function(a){t.user=a});{var l=new Firebase("https://study-buddy.firebaseio.com/groups/");new Firebase("https://study-buddy.firebaseio.com/groups/"+t.user.$id)}this.arr=e(l),console.log("banana")}]),angular.module("studyBuddy").controller("GroupCtrl",["$firebaseObject","$firebaseArray","Auth","$state",function(a,e,o,t){var l=this;o.onAuth(function(a){l.user=a}),o.loggedIn();var s=new Firebase("https://study-buddy.firebaseio.com/groups/"+l.user.$id);this.newGroup={},this.addGroup=function(a){s.update(a),t.go("list")}}]),angular.module("studyBuddy").controller("DashboardController",["Auth",function(a){var e=this;a.onAuth(function(a){e.user=a}),a.loggedIn()}]),angular.module("studyBuddy").controller("NavbarController",["Auth",function(a){this.loggedIn=a.loggedIn,this.logout=a.logout,this.isCollapsed=!0}]),angular.module("studyBuddy").run(["$templateCache",function(a){a.put("app/main/main.html",'<div id="login-box"><a id="login" ng-click="main.fbLogin()"><span class="glyphicon glyphicon-book"></span> <span class="fa fa-facebook"></span></a></div>'),a.put("app/dashboard/dashboard.html",'<p>{{\'Hello\'}} {{dash.user.name}}!</p><div class="jumbotron"><button class="btn btn-info"><a ui-sref="group">Create a Group</a></button> <button class="btn btn-info"><a ui-sref="list">Look for a Group</a></button></div>'),a.put("app/group/group.html",'<div class="group-view"><div class="col-sm-10 col-sm-offset-1 col-md-10 col-md-offset-1"><h3>{{\'Create a Group\'}}</h3><form ng-submit="groups.addGroup(groups.newGroup)" role="form"><div class="form-group col-md-4"><label for="subject">Subject</label> <input class="form-control" type="text" value="subject" ng-model="groups.newGroup.subject" required=""></div><div class="form-group col-md-4"><label for="class">Class</label> <input class="form-control" type="text" value="class" ng-model="groups.newGroup.class" required=""></div><div class="form-group col-md-4"><label for="select">Section</label><select class="form-control sections" value="select" ng-model="groups.newGroup.section" required=""><option value="A">A1</option><option value="B">B</option><option value="C">C</option><option value="D">D</option><option value="E">E</option></select></div><button class="submit btn btn-info pull-right">Submit</button></form></div><div class="map"><img class="lib-pic" src="../../assets/images/lib.png"></div></div>'),a.put("components/navbar/navbar.html",'<nav class="navbar navbar-static-top navbar-inverse" ng-controller="NavbarController as nav"><div class="container-fluid"><div class="navbar-header"><button ng-click="isCollapsed = !isCollapsed" type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" ui-sref="dashboard"><span class="glyphicon glyphicon-book"></span> Study Buddy</a></div><div collapse="!isCollapsed" class="collapse navbar-collapse navbar-right"><ul ng-click="isCollapsed = !isCollapsed" class="nav navbar-nav"><li><a ui-sref="dashboard">Home</a></li><li><a ui-sref="group">Create</a></li><li><a ui-sref="list">Search</a></li><li><a ui-sref="manage">Manage</a></li><li><a ui-sref="home" ng-click="nav.logout()">Logout</a></li></ul></div></div></nav>'),a.put("app/list/list.html",'<div class="list-view-container"><div sticky="" class="input-group col-sm-12"><input ng-model="searchText" placeholder="Search"></div><div class="list-view"><div class="top-map"><button class="btn btn-info col-xs-offset-9 col-sm-offset-10" ng-click="isCollapsed = !isCollapsed">View Map</button><div collapse="!isCollapsed"><div class="well well-lg map"><img class="lib-pic" src="../../assets/images/lib.png"></div></div></div><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">Active Groups</h3></div><div ng-repeat="group in list.arr | filter:searchText"><table class="table list"><tr><td>{{group.subject}}</td><td>{{group.class}}</td><td><span class="dropup" dropdown="" on-toggle="toggled(open)"><a href="" class="dropdown-toggle" dropdown-toggle="">{{group.section}}</a><ul class="dropdown-menu"><li><a href=""><img class="popup-map" src="../../assets/images/lib.png"></a></li></ul></span></td></tr></table></div></div></div></div>'),a.put("app/manage/manage.html",'<div class="manage-page"><div class="panel panel-info"><div class="panel-heading"><h3 class="panel-title">My Group</h3></div><table class="table list"><tr><td ng-hide="editing">{{manage.obj.subject}}</td><td ng-hide="editing">{{manage.obj.class}}</td><td ng-hide="editing">{{manage.obj.section}}</td></tr></table><form ng-show="editing" ng-submit="manage.edit(manage.update)"><input ng-model="manage.update.subject" type="text" placeholder="{{manage.obj.subject}}"> <input ng-model="manage.update.class" type="text" placeholder="{{manage.obj.class}}"> <input ng-model="manage.update.section" type="text" placeholder="{{manage.obj.section}}"></form></div><button class="btn btn-info col-xs-6 col-sm-offset-2 col-sm-4" ng-hide="manage.arr.length<1" ng-click="manage.delete(group)">Delete</button> <button class="btn btn-info col-xs-6 col-sm-4" ng-hide="editing || manage.arr.length<1" ng-click="editing = true">Edit</button> <button class="btn btn-info col-xs-6 col-sm-4" ng-show="editing" ng-click="editing = false">Save</button></div>')}]);